<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Success - Feedback Form Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            color: #1a202c;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
            margin: 0 auto 12px;
        }

        .company-name {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .tagline {
            font-size: 14px;
            color: #718096;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02), 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .card-subtitle {
            font-size: 15px;
            color: #718096;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
        }

        .required {
            color: #e53e3e;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input:read-only {
            background: #f7fafc;
            color: #718096;
            cursor: not-allowed;
        }

        input::placeholder, textarea::placeholder {
            color: #a0aec0;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 8px;
            flex-direction: row-reverse;
            justify-content: flex-end;
            font-size: 32px;
            margin-top: 8px;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            color: #cbd5e0;
            transition: color 0.2s;
            margin: 0;
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #fbbf24;
        }

        .rating-description {
            font-size: 13px;
            color: #718096;
            margin-top: 8px;
            font-weight: 400;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            display: flex;
            align-items: start;
            gap: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .alert-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            margin-top: 2px;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .hidden {
            display: none !important;
        }

        .intro-text {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 32px;
            font-size: 14px;
            line-height: 1.7;
            color: #2d3748;
        }

        .success-container {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #d1fae5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .success-icon svg {
            width: 48px;
            height: 48px;
            color: #065f46;
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 12px;
        }

        .success-message {
            font-size: 16px;
            color: #718096;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .card {
                padding: 24px;
            }

            .card-title {
                font-size: 20px;
            }

            body {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">DS</div>
            <div class="company-name">Debt Success</div>
            <div class="tagline">Turning money problems into solutions</div>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen">
            <div class="card">
                <h1 class="card-title">Welcome</h1>
                <p class="card-subtitle">Sign in to submit your feedback</p>

                <div id="loginAlert" class="alert alert-error hidden">
                    <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                    </svg>
                    <span id="loginAlertText"></span>
                </div>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="idNumber">ID Number <span class="required">*</span></label>
                        <input
                            type="text"
                            id="idNumber"
                            placeholder="Enter your 13-digit ID number"
                            maxlength="13"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address <span class="required">*</span></label>
                        <input
                            type="email"
                            id="email"
                            placeholder="your.email@example.com"
                            required
                        >
                    </div>

                    <button type="submit" class="btn btn-primary" id="loginBtn">
                        <span id="loginBtnText">Sign In</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Feedback Form Screen -->
        <div id="feedbackScreen" class="hidden">
            <div class="card">
                <h1 class="card-title">Questions/Feedback Form</h1>
                <p class="card-subtitle">Your feedback really matters to us ❤️</p>

                <div class="intro-text">
                    These short questions help us understand how each step of the Financial Wellness Programme is landing for you, what's been most helpful, and where we can improve or better support you.
                    <br><br>
                    There are no right or wrong answers, this is simply a space for you to reflect honestly on your experience so far and help us continue guiding you with care, clarity, and intention on your financial journey.
                </div>

                <div id="feedbackAlert" class="alert alert-success hidden">
                    <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span id="feedbackAlertText"></span>
                </div>

                <form id="feedbackForm">
                    <!-- Auto-filled User Info -->
                    <div class="form-group">
                        <label for="userName">Name and Surname</label>
                        <input
                            type="text"
                            id="userName"
                            readonly
                        >
                    </div>

                    <div class="form-group">
                        <label for="userIdNumber">ID Number</label>
                        <input
                            type="text"
                            id="userIdNumber"
                            readonly
                        >
                    </div>

                    <div class="form-group">
                        <label for="userEmail">Email</label>
                        <input
                            type="email"
                            id="userEmail"
                            readonly
                        >
                    </div>

                    <!-- FWP Step Selection -->
                    <div class="form-group">
                        <label for="fwpStep">Which FWP step are you responding to? <span class="required">*</span></label>
                        <select id="fwpStep" required>
                            <option value="">Please select one option</option>
                            <option value="Step 1">Step 1</option>
                            <option value="Step 2">Step 2</option>
                            <option value="Step 3">Step 3</option>
                            <option value="Step 4">Step 4</option>
                            <option value="Step 5">Step 5</option>
                            <option value="Step 6">Step 6</option>
                            <option value="Step 7">Step 7</option>
                            <option value="Step 8">Step 8</option>
                            <option value="Step 9">Step 9</option>
                            <option value="Step 10">Step 10</option>
                            <option value="Step 11">Step 11</option>
                            <option value="Step 12">Step 12</option>
                        </select>
                    </div>

                    <!-- Read Guide -->
                    <div class="form-group">
                        <label for="readGuide">Did you read or work through the Step guide? <span class="required">*</span></label>
                        <select id="readGuide" required>
                            <option value="">Please select one option</option>
                            <option value="Yes, fully">Yes, fully</option>
                            <option value="Partially">Partially</option>
                            <option value="Not yet">Not yet</option>
                        </select>
                    </div>

                    <!-- Star Rating -->
                    <div class="form-group">
                        <label>How helpful did you find this step? <span class="required">*</span></label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="helpfulness" value="5" required>
                            <label for="star5">★</label>
                            <input type="radio" id="star4" name="helpfulness" value="4">
                            <label for="star4">★</label>
                            <input type="radio" id="star3" name="helpfulness" value="3">
                            <label for="star3">★</label>
                            <input type="radio" id="star2" name="helpfulness" value="2">
                            <label for="star2">★</label>
                            <input type="radio" id="star1" name="helpfulness" value="1">
                            <label for="star1">★</label>
                        </div>
                        <div class="rating-description">Scale: 1 (Not helpful) → 5 (Very helpful)</div>
                    </div>

                    <!-- Insight -->
                    <div class="form-group">
                        <label for="insight">What was the most useful or meaningful insight from this step? <span class="required">*</span></label>
                        <textarea
                            id="insight"
                            rows="4"
                            placeholder="Share what resonated with you..."
                            required
                        ></textarea>
                    </div>

                    <!-- Confusing Parts -->
                    <div class="form-group">
                        <label for="confusing">Were there any parts of this step that felt confusing or difficult?</label>
                        <textarea
                            id="confusing"
                            rows="4"
                            placeholder="Help us improve..."
                        ></textarea>
                    </div>

                    <!-- Applied Anything -->
                    <div class="form-group">
                        <label for="applied">Have you been able to apply anything from this step in your daily life yet?</label>
                        <select id="applied">
                            <option value="">Please select one option</option>
                            <option value="Yes">Yes</option>
                            <option value="Not yet">Not yet</option>
                        </select>
                    </div>

                    <!-- Journey Feeling -->
                    <div class="form-group">
                        <label for="journeyFeel">How are you feeling about your financial journey right now?</label>
                        <select id="journeyFeel">
                            <option value="">Please select one option</option>
                            <option value="Calm and in control">Calm and in control</option>
                            <option value="Managing, but still stressed">Managing, but still stressed</option>
                            <option value="Overwhelmed">Overwhelmed</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div>

                    <!-- Check-in Request -->
                    <div class="form-group">
                        <label for="checkIn">Would you like someone from Debt Success to check in with you?</label>
                        <select id="checkIn">
                            <option value="">Please select one option</option>
                            <option value="Yes, please phone me">Yes, please phone me</option>
                            <option value="Yes, please WhatsApp me">Yes, please WhatsApp me</option>
                            <option value="Yes, please email me">Yes, please email me</option>
                            <option value="Not at this stage">Not at this stage</option>
                        </select>
                    </div>

                    <!-- Additional Comments -->
                    <div class="form-group">
                        <label for="comments">Any additional comments or questions you'd like to share?</label>
                        <textarea
                            id="comments"
                            rows="4"
                            placeholder="Anything else you'd like to share..."
                        ></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" id="feedbackBtn">
                        <span id="feedbackBtnText">Submit</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="hidden">
            <div class="card">
                <div class="success-container">
                    <div class="success-icon">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                    </div>
                    <h1 class="success-title">Thank You!</h1>
                    <p class="success-message">
                        Your feedback has been submitted successfully. Your counselor will review it soon.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION - WEBHOOK URLS
        // ========================================
        const ZAPIER_WEBHOOK_LOGIN = 'https://hooks.zapier.com/hooks/catch/18655142/ule7sa1/';
        const ZAPIER_WEBHOOK_FEEDBACK = 'https://hooks.zapier.com/hooks/catch/18655142/ulcd4ye/';

        let currentClient = null;

        // ========================================
        // TEMPORARY: Hardcoded test data (bypassing login for now)
        // ========================================
        const TEST_MODE = true; // Set to false when login webhook is working
        const TEST_CLIENT_DATA = {
            idNumber: "8605025095082",
            email: "stiaan@saltandlightcreations.co.za",
            name: "Stiaan van Zyl"
        };

        // ========================================
        // LOGIN
        // ========================================
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const idNumber = document.getElementById('idNumber').value.trim();
            const email = document.getElementById('email').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginAlert = document.getElementById('loginAlert');
            const loginAlertText = document.getElementById('loginAlertText');

            loginBtn.disabled = true;
            loginBtnText.textContent = 'Signing in...';
            loginAlert.classList.add('hidden');

            // TEMPORARY: Use test mode to bypass login webhook
            if (TEST_MODE) {
                // Check if credentials match test data
                if (idNumber === TEST_CLIENT_DATA.idNumber && email === TEST_CLIENT_DATA.email) {
                    currentClient = TEST_CLIENT_DATA;
                    setTimeout(() => {
                        showFeedbackForm();
                    }, 500); // Simulate API delay
                } else {
                    loginAlertText.textContent = 'Invalid ID number or email address. For testing, use: ID: 8605025095082, Email: stiaan@saltandlightcreations.co.za';
                    loginAlert.classList.remove('hidden');
                    loginBtn.disabled = false;
                    loginBtnText.textContent = 'Sign In';
                }
                return;
            }

            // REAL LOGIN (when webhook works)
            try {
                const response = await fetch(ZAPIER_WEBHOOK_LOGIN, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idNumber, email })
                });

                const data = await response.json();

                if (data.success && data.client) {
                    currentClient = data.client;
                    showFeedbackForm();
                } else {
                    loginAlertText.textContent = data.error || 'Invalid ID number or email address. Please check your details and try again.';
                    loginAlert.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                loginAlertText.textContent = 'Unable to connect. Please check your internet connection and try again.';
                loginAlert.classList.remove('hidden');
            } finally {
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Sign In';
            }
        });

        // ========================================
        // SHOW FEEDBACK FORM
        // ========================================
        function showFeedbackForm() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('feedbackScreen').classList.remove('hidden');

            // Auto-fill user data
            document.getElementById('userName').value = currentClient.name || '';
            document.getElementById('userIdNumber').value = currentClient.idNumber || '';
            document.getElementById('userEmail').value = currentClient.email || '';
        }

        // ========================================
        // FEEDBACK FORM SUBMISSION
        // ========================================
        document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const feedbackBtn = document.getElementById('feedbackBtn');
            const feedbackBtnText = document.getElementById('feedbackBtnText');
            const feedbackAlert = document.getElementById('feedbackAlert');
            const feedbackAlertText = document.getElementById('feedbackAlertText');

            feedbackBtn.disabled = true;
            feedbackBtnText.textContent = 'Submitting...';
            feedbackAlert.classList.add('hidden');

            // Get selected FWP step for analytics
            const selectedStep = document.getElementById('fwpStep').value;

            // Get star rating value
            const helpfulness = document.querySelector('input[name="helpfulness"]:checked')?.value || '';

            const feedbackData = {
                // User Info (from logged-in client)
                idNumber: currentClient.idNumber,
                name: currentClient.name,
                email: currentClient.email,

                // Form Fields
                fwpStep: selectedStep,
                readGuide: document.getElementById('readGuide').value,
                helpfulness: helpfulness,
                insight: document.getElementById('insight').value,
                confusing: document.getElementById('confusing').value || '',
                applied: document.getElementById('applied').value || '',
                journeyFeel: document.getElementById('journeyFeel').value || '',
                checkIn: document.getElementById('checkIn').value || '',
                comments: document.getElementById('comments').value || '',

                // Timestamp
                submittedAt: new Date().toISOString()
            };

            try {
                const response = await fetch(ZAPIER_WEBHOOK_FEEDBACK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(feedbackData)
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess();
                } else {
                    feedbackAlertText.textContent = data.error || 'Unable to submit feedback. Please try again.';
                    feedbackAlert.className = 'alert alert-error';
                    feedbackAlert.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Feedback submission error:', error);
                feedbackAlertText.textContent = 'Unable to connect. Please check your internet connection.';
                feedbackAlert.className = 'alert alert-error';
                feedbackAlert.classList.remove('hidden');
            } finally {
                feedbackBtn.disabled = false;
                feedbackBtnText.textContent = 'Submit';
            }
        });

        // ========================================
        // SHOW SUCCESS SCREEN
        // ========================================
        function showSuccess() {
            document.getElementById('feedbackScreen').classList.add('hidden');
            document.getElementById('successScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>
